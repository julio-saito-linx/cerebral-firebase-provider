{"version":3,"sources":["../src/helpers.js"],"names":["createRef","createStorageRef","listenTo","stopListening","createUser","createReturnPromise","noop","snapshotToArray","refs","path","options","indexOf","FirebaseProviderError","Error","replace","Object","keys","reduce","ref","key","firebase","database","storage","event","signal","cb","concat","on","error","message","events","onChildAdded","onChildChanged","onChildRemoved","onValue","passedPath","realEventName","pathArray","split","isWildcardPath","length","pop","join","refsHit","currentKeysHit","refPath","forEach","eventName","listener","off","user","uid","isAnonymous","providerData","displayName","email","emailVerified","photoURL","returnPromise","promise","then","response","catch","success","snapshot","result","childSnapshot","push","value","val"],"mappings":"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","file":"helpers.js","sourcesContent":["import firebase from 'firebase'\nimport { FirebaseProviderError } from './errors'\nconst refs = {}\n\nexport function createRef(path, options = {}) {\n  if (path.indexOf('/') >= 0) {\n    throw new FirebaseProviderError(\n      new Error(\n        'The path \"' +\n          path +\n          '\" is not valid. Use dot notation for consistency with Cerebral'\n      )\n    )\n  }\n  path = path.replace(/\\./g, '/')\n  return Object.keys(options).reduce((ref, key) => {\n    switch (key) {\n      case 'payload':\n        return ref\n      case 'asArray':\n        return ref\n      case 'orderByKey':\n        return options[key] ? ref[key]() : ref\n      case 'orderByValue':\n        return options[key] ? ref[key]() : ref\n      default:\n        return ref[key](options[key])\n    }\n  }, firebase.database().ref(path))\n}\n\nexport function createStorageRef(path) {\n  if (path.indexOf('/') >= 0) {\n    throw new FirebaseProviderError(\n      new Error(\n        'The path \"' +\n          path +\n          '\" is not valid. Use dot notation for consistency with Cerebral'\n      )\n    )\n  }\n  path = path.replace(/\\./g, '/')\n  return firebase.storage().ref(path)\n}\n\nexport function listenTo(ref, path, event, signal, cb) {\n  refs[path] = refs[path] || {}\n  refs[path][event] = refs[path][event] ? refs[path][event].concat(ref) : [ref]\n\n  ref.on(event, cb, (error) => {\n    throw new FirebaseProviderError(\n      new Error(\n        event +\n          ' listener to path ' +\n          path +\n          ', triggering signal: ' +\n          signal +\n          ', gave error: ' +\n          error.message\n      )\n    )\n  })\n}\n\nconst events = {\n  onChildAdded: 'child_added',\n  onChildChanged: 'child_changed',\n  onChildRemoved: 'child_removed',\n  onValue: 'value',\n  '*': '*',\n}\n\nexport function stopListening(passedPath, event) {\n  const realEventName = events[event] || '*'\n  const pathArray = passedPath.split('.')\n  let path = passedPath\n  let isWildcardPath = false\n\n  if (event && !realEventName) {\n    throw new FirebaseProviderError(\n      new Error(\n        'The event \"' +\n          event +\n          '\" is not a valid event. Use: \"' +\n          Object.keys(events)\n      )\n    )\n  }\n\n  if (pathArray[pathArray.length - 1] === '*') {\n    isWildcardPath = true\n    pathArray.pop()\n    path = pathArray.join('.')\n  }\n\n  let refsHit\n  if (isWildcardPath) {\n    refsHit = Object.keys(refs).reduce((currentKeysHit, refPath) => {\n      if (refPath.indexOf(path) === 0) {\n        return currentKeysHit.concat(refPath)\n      }\n\n      return currentKeysHit\n    }, [])\n  } else {\n    refsHit = refs[path] ? [path] : []\n  }\n\n  if (!refsHit.length) {\n    throw new FirebaseProviderError(\n      new Error('The path \"' + path + '\" has no listeners')\n    )\n  }\n\n  refsHit.forEach((refPath) => {\n    const ref = refs[refPath]\n    if (realEventName === '*') {\n      Object.keys(ref).forEach((eventName) => {\n        ref[eventName].forEach((listener) => listener.off())\n        delete ref[eventName]\n      })\n    } else {\n      if (!ref[realEventName]) {\n        throw new FirebaseProviderError(\n          new Error(\n            'The path\"' +\n              path +\n              '\" has no listeners for \"' +\n              realEventName +\n              '\"'\n          )\n        )\n      }\n      ref[realEventName].forEach((listener) => listener.off())\n      delete ref[realEventName]\n    }\n\n    if (Object.keys(ref).length === 0) {\n      delete refs[refPath]\n    }\n  })\n}\n\nexport function createUser(user) {\n  return {\n    uid: user.uid,\n    isAnonymous: user.isAnonymous,\n    providerData: user.providerData,\n    displayName: user.displayName,\n    email: user.email,\n    emailVerified: user.emailVerified,\n    photoURL: user.photoURL,\n  }\n}\n\nexport function createReturnPromise(returnPromise, path) {\n  let promise = returnPromise\n\n  if (!path) {\n    promise = promise\n      .then((response) => (response ? { response } : {}))\n      .catch((error) => ({ error }))\n  }\n\n  if (path && path.success) {\n    promise = promise.then(\n      (response) => (response ? path.success({ response }) : path.success())\n    )\n  }\n  if (path && path.error) {\n    promise = promise.catch((error) => {\n      return path.error({ error })\n    })\n  }\n\n  return promise\n}\n\nexport function noop() {}\n\nexport function snapshotToArray(snapshot) {\n  const result = []\n\n  snapshot.forEach((childSnapshot) => {\n    result.push({\n      key: childSnapshot.key,\n      value: childSnapshot.val(),\n    })\n  })\n\n  return result\n}\n"]}